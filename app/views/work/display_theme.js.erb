//-# * Created by aleks_ivanishchev on 19.09.16

// get data from controller
var imageData = '<%= raw @image_data %>';
console.log("IN display_theme: @image_data = " + imageData );

// show theme
var selectedTheme = '<%= @image_data[:theme] %>';
console.log("3a IN display_theme: selectedTheme = " + selectedTheme);

if(selectedTheme == "Select theme to leave your answer" || selectedTheme == ""){
  $('.img-left-side').css({"display": "none"});
  $('.img-right-side').css({"display": "none"});
  $('.image .image_display .image_diag').css({"display": "none"});

}else{
  $('.img-left-side').css({"display": "block"});
  $('.img-right-side').css({"display": "block"});
  $('.image .image_display .image_diag').css({"display": "block"});

}

var currentUserId = '<%= @image_data[:current_user_id] %>';
console.log("3d IN display_theme: currentUserId = " + currentUserId);

var userValuedImage = '<%= @image_data[:user_valued] %>';
console.log("3d IN display_theme: userValuedImage = " + userValuedImage);


$('.image_display h2.up-theme').append().html(selectedTheme);

//var titleImage = "Click this image to analyse it";
//$('.img-title').append().html(titleImage);

//restore button
$('.select_theme').empty().html("<%= j render 'work/button_theme_select' -%>");

// get data from controller
var imageCurrentIndex = '<%= @image_data[:index] %>';
//var firstThemeImagesName = JSON.parse(firstThemeImages)["name"];
var oneImageName = '<%= @image_data[:name] %>';
//console.log("3a IN display_theme: oneImageName = " + oneImageName);
var oneImageFile = '<%= @image_data[:file] %>';
console.log("3b IN display_theme: oneImageFile = " + oneImageFile);
var oneImageId = '<%= @image_data[:image_id] %>';
console.log("3b IN display_theme: oneImageId = " + oneImageId);
var themeImagesSize = '<%= @image_data[:images_arr_size] %>';
//console.log("3c IN display_theme: themeImagesSize = " + themeImagesSize);
var selectedThemeId = '<%= @image_data[:theme_id] %>';


// show name of image
//var nameImage = selectedImage.slice(0,-4) ;  // put away . file .jpr
$('.image_display h2.up').append().html(oneImageName);

// show image
var pathImage = "assets/pictures/" + oneImageFile;
// $('.img-center').html('<img alt="Selected Image" src="'+ pathImage + '"/>');
$(".img-center").attr({title: "Selected image" });
$(".img-center img").attr({alt: "Selected Image", src: pathImage, title: "Selected image" });




// AJAX call to next image list
$('.img-right-side').click(function(event) {
//  console.log("link clicked: selectedTheme =  " + selectedTheme);
  event.stopImmediatePropagation(); // would stop the event from bubbling to parent elements,

//    //$('.image_display .image_diag .indicator .outer-circle').removeClass("show");
//    $('.image_display .image_diag .scale .small_img_box').css({"display": "none"});
//    $('.image_display .indic-circ').css({"display": "none"});
//    $('.image_display .image_diag h2.down').css({"display": "none"});
//    // not prevent other click handlers on the same element from firing.

  $.ajax({
    type: "get",
    url: "next_image",
    data: { index: imageCurrentIndex,
            theme_id: selectedThemeId,
            length: themeImagesSize },
    dataType: 'json'
  }).done(function (data_return) {
        console.log("success1c:  " + data_return.notice );
        imageCurrentIndex = data_return.new_image_index;
        console.log("1 IN ajax.show_next_image after done: display_theme: imageCurrentIndex = " + imageCurrentIndex );
        oneImageName = data_return.name;
        console.log("2 IN ajax.show_next_image after done: display_theme: oneImageName = " + oneImageName );
        oneImageFile = data_return.file;
        console.log("3 IN ajax.show_next_image after done:: oneImageFile = " + oneImageFile);
        oneImageId = data_return.image_id;
        $('.image_display h2.up').append().html(oneImageName);
        var pathImage = "assets/pictures/" + oneImageFile;
        $(".img-center").attr({title: "Selected image" });
        $(".img-center img").attr({alt: "Selected Image", src: pathImage, title: "Selected image" });

      })
      .fail(function (data_return) {
        console.log("error: data_return = " + data_return);
      });

});



// AJAX call to previous image list
$('.img-left-side').click(function(event) {
  event.stopImmediatePropagation(); // would stop the event from bubbling to parent elements,

//    //$('.image_display .image_diag .indicator .outer-circle').removeClass("show");
//    $('.image_display .image_diag .indicator .outer-circle').css({"display": "none"});
//    $('.image_display .image_diag .scale .small_img_box').css({"display": "none"});
//    $('.image_display .indic-circ').css({"display": "none"});
//    $('.image_display .image_diag h2.down').css({"display": "none"});
//    // not prevent other click handlers on the same element from firing.

  $.ajax({
    type: "get",
    url: "prev_image",
    data: { index: imageCurrentIndex,
      theme_id: selectedThemeId,
      length: themeImagesSize },
    dataType: 'json'
  }).done(function (data_return) {
        console.log("success1c:  " + data_return.notice );
        imageCurrentIndex = data_return.new_image_index;
        console.log("1 IN ajax.show_next_image after done: display_theme: imageCurrentIndex = " + imageCurrentIndex );
        oneImageName = data_return.name;
        console.log("2 IN ajax.show_next_image after done: display_theme: oneImageName = " + oneImageName );
        oneImageFile = data_return.file;
        console.log("3 IN ajax.show_next_image after done:: oneImageFile = " + oneImageFile);
        oneImageId = data_return.image_id;

        $('.image_display h2.up').append().html(oneImageName);
        var pathImage = "assets/pictures/" + oneImageFile;
        $(".img-center").attr({title: "Selected image" });
        $(".img-center img").attr({alt: "Selected Image", src: pathImage, title: "Selected image" });

      })
      .fail(function (data_return) {
        console.log("error: data_return = " + data_return);
      });

});






// AJAX call to next image list
$('button.button__results.save').unbind( "click" ).click(function(event) {
  console.log("clicked: button__results.save: ");
  event.stopImmediatePropagation(); // would stop the event from bubbling to parent elements,

  //  var result = document.getElementsByClassName("elementa")[0].innerHTML;
  var displayValue = $('#chosen_value')[0].innerHTML;
  console.log("displayValue = " + displayValue );

  $.ajax({
    type: "get",
    url: "save_value",
    data: { image_id: oneImageId,
            theme_id: selectedThemeId,
            value: displayValue },
    dataType: 'json'
  }).done(function (data_return) {
        console.log("success1c:  " + data_return.notice );
        var userImageValue = data_return.user_value;
        console.log("1 IN ajax.save_value after done: display_theme: userImageValue = " + userImageValue );
        var averageValue = data_return.ave_value;
        console.log("2 IN ajax.show_next_image after done: display_theme: averageValue = " + averageValue );
//        oneImageFile = data_return.file;
//        console.log("3 IN ajax.show_next_image after done:: oneImageFile = " + oneImageFile);

          // $('.image_display .ave_value').css({"display": "block"});
        $('.image_display .image_user_value').append().html(userImageValue);
        $('.image_display .ave_value').append().html(averageValue);



//        $('.image_display h2.up').append().html(oneImageName);
//        var pathImage = "assets/pictures/" + oneImageFile;
//        $(".img-center").attr({title: "Selected image" });
//        $(".img-center img").attr({alt: "Selected Image", src: pathImage, title: "Selected image" });

      })
      .fail(function (data_return) {
        console.log("error: data_return = " + data_return);
      });



});


////        var diagReturned = "diag_Hk: " + data_return.result_hk + "; time: " + data_return.diag_time + " ms;";
//        $('.image_display .image_diag h2.down').css({"display": "block"}).empty()
//            .before().append().html(diagReturned).fadeOut(4500);
//        //setTimeout("window.location.href='< %= home_path %>';",2000);; .fadeOut(4500)
//
//        var resultHK = data_return.result_hk;
//        console.log("resultHK:  " + resultHK );
//        var resultColorIndicator = data_return.color_indicator;
//        console.log("resultColorIndicator:  " + resultColorIndicator );
//
//        var imgScalePos = data_return.img_scale_pos + "%";
//        console.log("imgScalePos:  " + imgScalePos );
//
//        var newLeft ;
//        var newClass;
//        //$('.image_display .image_diag .indicator .outer-circle').addClass('show ');
//        $('.image_display .image_diag .indicator .outer-circle').css({
//          "display": "block",
//          "left": "43.75%",
//          "border-color": resultColorIndicator
//        });
//        $('.image_display .indic-circ').css({
//          "display": "block",
//          "left": "43.75%",
//          "border-color": resultColorIndicator
//        });
//
//        $('.image_display .image_diag .scale .small_img_box').css({"left": imgScalePos, "display": "block" });
//        newClass = $('.image_display .image_diag .indicator .outer-circle').attr("class");
//        console.log("attr: newClass = " + newClass);
//        newLeft = $('.image_display .image_diag .indicator .outer-circle').css("left");
//        console.log("attr border: newLeft = " + newLeft);
//        //            find(".nayIt").addClass("notChosen "  // border: 30px solid #30fa29  // .delay(2000)
//        $('.image_display .image_diag .scale').css({
//          "display": "block"
////                "border-color": function(){
////                    return isNaN(resultHK) ? '#000' : resultHK < 200 ? '#f00' : resultHK < 350 ? '#0ff' : '#f90';
////                }
////                "border-color": indicator_color(resultHK)
////                "border-color": resultColorIndicator
//
//        });

//
//
//$('.img-left-side').click(function(event) {  //ajax
//  console.log("IN display_image - in onclick function(): selected nameImage = " + nameImage );
//  console.log("link clicked: selectedImage =  " + selectedImage);
//  //$('.image_diag h2.down').append().html(selectedImage);
//  event.stopImmediatePropagation(); // would stop the event from bubbling to parent elements,
//
//  //$('.image_display .image_diag .indicator .outer-circle').removeClass("show");
//  $('.image_display .image_diag .indicator .outer-circle').css({"display": "none"});
//  $('.image_display .image_diag .scale .small_img_box').css({"display": "none"});
//  $('.image_display .indic-circ').css({"display": "none"});
//  $('.image_display .image_diag h2.down').css({"display": "none"});
//  // not prevent other click handlers on the same element from firing.
//
//  $.ajax({
//    type: "get",
//    // url: "diag_image",
//    url: "analyse",
//    data: { value: selectedImage },
//    dataType: 'json'
//  }).done(function (data_return) {
//        console.log("success1c:  " + data_return.notice );
//
//        var diagReturned = "diag_Hk: " + data_return.result_hk + "; time: " + data_return.diag_time + " ms;";
//        $('.image_display .image_diag h2.down').css({"display": "block"}).empty()
//            .before().append().html(diagReturned).fadeOut(4500);
//        //setTimeout("window.location.href='< %= home_path %>';",2000);; .fadeOut(4500)
//
//        var resultHK = data_return.result_hk;
//        console.log("resultHK:  " + resultHK );
//        var resultColorIndicator = data_return.color_indicator;
//        console.log("resultColorIndicator:  " + resultColorIndicator );
//
//        var imgScalePos = data_return.img_scale_pos + "%";
//        console.log("imgScalePos:  " + imgScalePos );
//
//        var newLeft ;
//        var newClass;
//        //$('.image_display .image_diag .indicator .outer-circle').addClass('show ');
//        $('.image_display .image_diag .indicator .outer-circle').css({
//          "display": "block",
//          "left": "43.75%",
//          "border-color": resultColorIndicator
//        });
//        $('.image_display .indic-circ').css({
//          "display": "block",
//          "left": "43.75%",
//          "border-color": resultColorIndicator
//        });
//
//        $('.image_display .image_diag .scale .small_img_box').css({"left": imgScalePos, "display": "block" });
//        newClass = $('.image_display .image_diag .indicator .outer-circle').attr("class");
//        console.log("attr: newClass = " + newClass);
//        newLeft = $('.image_display .image_diag .indicator .outer-circle').css("left");
//        console.log("attr border: newLeft = " + newLeft);
//        //            find(".nayIt").addClass("notChosen "  // border: 30px solid #30fa29  // .delay(2000)
//        $('.image_display .image_diag .scale').css({
//          "display": "block"
////                "border-color": function(){
////                    return isNaN(resultHK) ? '#000' : resultHK < 200 ? '#f00' : resultHK < 350 ? '#0ff' : '#f90';
////                }
////                "border-color": indicator_color(resultHK)
////                "border-color": resultColorIndicator
//
//        });
//      })
//      .fail(function (data_return) {
//        console.log("error: data_return = " + data_return);
//      });
//
//
//});
//

