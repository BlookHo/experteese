var dirFile = '<%= @image_diag %>';
console.log("IN display_device_image - @image_diag: dirFile = " + dirFile );
//alert('success!');
<!--<% if remotipart_submitted? %>-->
//    alert('submitted via remotipart');
<!--<% else %>-->
//    alert('submitted via native jquery-ujs');
<!--<% end %>-->


//var imageUrl = '<%= @image_url %>';
//console.log("IN display_device_image: imageUrl = " + imageUrl );
var imageFileName = '<%= @image_file_name %>';
console.log("IN display_device_image: imageFileName = " + imageFileName );
var imagePath = '<%= @image_path %>';
console.log("IN display_device_image: imagePath = " + imagePath );


//var tempFileImage  = '<%= @image_tempfile %>';
//console.log("IN display_image_by_url: tempFileImage = " + tempFileImage );
var imageTempfilePath  = '<%= @image_tempfile_path %>';
console.log("IN display_device_image: imageTempfilePath = " + imageTempfilePath );
var imageFileName  = '<%= @image_tempfile_name %>';
console.log("IN display_device_image: imageFileName = " + imageFileName );

var nameImage = imageFileName.slice(0,-4) ;  // put away . file .jpr
$('.image_display h2.up').append().html(nameImage);

var dirFile = '<%= @image_dir %>';
console.log("IN display_device_image: dirFile = " + dirFile );
var pathImage = dirFile + imageFileName;
console.log("IN display_device_image: pathImage = " + pathImage );
var pathLongImage = "app/assets/images/pictures/" + imageFileName;
console.log("IN display_device_image: pathLongImage = " + pathLongImage );


$(".img-center img").attr({alt: "Selected Image", src: pathImage, title: "Selected image" });
//$(".img-center img").attr({alt: "Selected Image", src: dirFile, title: "Selected image" });
$(".image_diag .scale .small_img_box img").attr({alt: "Selected Image", src: pathImage, title: "Selected image" });
$('.img-left-side .button__results').css({"display": "none"});

var titleImage = "Click this image to analyse it";
$('.img-title').append().html(titleImage);

$('.form_select').remove('.form_select');
$('.load_image').empty().html("<%= j render 'images/button_load' -%>");
$('.select_image').html("<%= j render 'images/button_select' -%>");
$('.modal_list_results').html("<%= j render 'images/button_list_results' -%>");

$('.img-center').unbind( "click" ).click(function by_url(event) {  //ajax
    console.log("IN display_device_image - in onclick function(): selected nameImage = " + nameImage );
    console.log("link clicked: selectedImage: imageFileName =  " + imageFileName);
    event.stopImmediatePropagation(); // would stop the event from bubbling to parent elements,

    $('.image_display .image_diag .indicator .outer-circle').css({"display": "none"});
    $('.image_display .image_diag .scale .small_img_box').css({"display": "none"});
    $('.image_display .indic-circ').css({"display": "none"});
    $('.image_display .image_diag h2.down').css({"display": "none"});
    // not prevent other click handlers on the same element from firing.

    $.ajax({
        type: "get",
        url: "analyse_uploaded_file",
        data: { image_file: imageFileName, file_path: pathLongImage },
        dataType: 'json'
    }).done(function (data_return) {
        console.log("success Analyse Uploaded file:  " + data_return.notice );

        var diagReturned = "diag_Hk: " + data_return.result_hk + "; time: " + data_return.diag_time + " ms;";
        $('.image_display .image_diag h2.down').css({"display": "block"}).empty()
                .before().append().html(diagReturned).fadeOut(4500);

        var resultHK = data_return.result_hk;
        console.log("resultHK:  " + resultHK );
        var resultColorIndicator = data_return.color_indicator;
        console.log("resultColorIndicator:  " + resultColorIndicator );

        var imgScalePos = data_return.img_scale_pos + "%";
        console.log("imgScalePos:  " + imgScalePos );

        $('.image_display .image_diag .indicator .outer-circle').css({
            "display": "block",
            "left": "43.75%",
            "border-color": resultColorIndicator
        });
        $('.image_display .indic-circ').css({
            "display": "block",
            "left": "43.75%",
            "border-color": resultColorIndicator
        });

        $('.image_display .image_diag .scale .small_img_box').css({"left": imgScalePos, "display": "block" });
//        newClass = $('.image_display .image_diag .indicator .outer-circle').attr("class");
//        console.log("attr: newClass = " + newClass);
//        newLeft = $('.image_display .image_diag .indicator .outer-circle').css("left");
//        console.log("attr border: newLeft = " + newLeft);
        $('.image_display .image_diag .scale').css({
            "display": "block"
//                "border-color": function(){
//                    return isNaN(resultHK) ? '#000' : resultHK < 200 ? '#f00' : resultHK < 350 ? '#0ff' : '#f90';
//                }
//                "border-color": indicator_color(resultHK)
//                "border-color": resultColorIndicator
        });
        $('.button__results').css({"display": "block"});

    })
            .fail(function (data_return) {
                console.log("error: data_return = " + data_return);
            });

});



$('button.button__results.yes').unbind( "click" ).click(function save_results(event) {
    console.log("button__results  .yes clicked: imageFileName =  " + imageFileName);
    console.log("button__results  .yes clicked: imageTempfilePath =  " + imageTempfilePath);
    console.log("button__results  .yes clicked: pathLongImage =  " + pathLongImage);
    event.stopImmediatePropagation(); // would stop the event from bubbling to parent elements,
    $('.button__results').css({"display": "none"});
});



$('button.button__results.no').unbind( "click" ).click(function save_results(event) {  //ajax
    console.log("display_device: button__results  .no clicked: imageFileName =  " + imageFileName);
    console.log("button__results  .no clicked: imageTempfilePath =  " + imageTempfilePath);
    console.log("button__results  .no clicked: pathLongImage =  " + pathLongImage);
    event.stopImmediatePropagation(); // would stop the event from bubbling to parent elements,
    $.ajax({
        type: "get",
        url: "clear_diag_result",
        data: { image_file: imageFileName, file_path: imageTempfilePath },
        dataType: 'json'
    }).done(function (data_return) {
        console.log("success Analyse Uploaded file:  " + data_return.notice );
        $('.button__results').css({"display": "none"});
    })
    .fail(function (data_return) {
        console.log("error: data_return = " + data_return);
    });

});

